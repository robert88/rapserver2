
"use strict";

module.exports = class AsyncSeries{
	constructor(array, iterator, callback){
		this.queue = array;
		this.status = "ide";
		this.iterator = iterator;
		this.callback = callback;
		this.length = this.queue.length;
		this.run();
	}
	run(){
		if(this.status=="ide"){
			this.status = "busy";
			this.next();
		}
	}
	next(data){

		if(this.queue.length){
			var runItem = this.queue.shift();
			//通过iterator调用loop来控制下一个的执行
			this.iterator(runItem,this.length-this.queue.length-1,this);
		}else{
			this.done(data);
		}
	}
	done(data){
		this.status = "ide";
		this.callback(data);
		this.queue = null;
		this.iterator = null;
		this.callback = null;
	}
}

